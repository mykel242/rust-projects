<!doctype html>
<html>

<head>
  <title>My Test App</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="/uikit/css/uikit.css" />
  <script src="/jquery/jquery.min.js"></script>
  <script src="/uikit/js/uikit.min.js"></script>
  <script src="/uikit/js/uikit-icons.min.js"></script>

  <!-- Tauri / Rust bindings-->
  <script type="module" src="/main.js" defer></script>

  <style>
    .app-brand {
      margin-top: 0.5em;
      background-color: #ddd;
      box-sizing: content-box;
      border-radius: 12px 0 0 12px;
    }

    .no-dec {
      list-style-type: none;
    }

    .pad {
      padding: 1em;
    }

    .pad-lt {
      padding-left: 1em;
    }

    .flt-rt {
      float: right;
    }

    .mar-rt {
      margin-right: 0.5em;
    }

    .hide-me {
      display: none;
    }

    input.invalid,
    input:invalid {
      box-shadow: 0 0 5px 1px rgb(62, 194, 242);
    }

    input:focus:invalid {
      box-shadow: none;
    }
  </style>
</head>

<body>
  <div class="uk-container uk-margin-top">
    <!-- top nav bar -->
    <ul uk-tab>
      <li class="uk-active"><a href="#">home</a></li>
      <li><a href="#">accounts</a></li>
    </ul>
    <div class="uk-position-top-right app-brand">
      <ul class="uk-margin-top uk-margin-right no-dec">
        <li>
          <h2>hoard.</h2>
        </li>
      </ul>
    </div>
  </div>
  <!-- outer-most container -->

  <div class="uk-container uk-margin">
    <button id="btn-new-account" class="uk-button uk-button-primary"><span uk-icon="plus-circle"></span>
      Account</button>
  </div>


  <div id="welcome-section" class="uk-container uk-margin hide-me">
    <div class="uk-section uk-section-primary pad-lt">
      <h3>hello world.</h3>
      <p>Vestibulum eleifend sem ac dui fermentum facilisis. Aliquam faucibus, magna venenatis tincidunt laoreet, nibh
        felis finibus dui, non ornare felis massa sit amet lorem. Donec hendrerit dignissim accumsan. Fusce auctor ante
        turpis. Praesent imperdiet augue quis diam sollicitudin, non vestibulum ex interdum. Nulla sit amet magna
        ligula.</p>
    </div>
  </div>

  <div id="new-account-form" class="uk-container uk-margin hide-me">
    <div class="uk-section uk-section-muted pad">
      <form class="uk-margin">
        <legend class="uk-legend">new account</legend>
        <div class="uk-margin">
          <label>Account</label>
          <input id="new-account-form-label" class="uk-input" type="text" placeholder="required" aria-label="Input"
            minlength="3" maxlength="512" required>
        </div>
        <div class="uk-margin">
          <label>Balance</label>
          <input id="new-account-form-balance" class="uk-input" type="text" placeholder="$0.00" aria-label="Input"
            required>
        </div>
        <div class="uk-margin">
          <select id="new-account-form-type" class="uk-select" aria-label="Select" required>
            <option disabled value="0" selected hidden>Type of Account</option>
            <option value="1">Checking</option>
            <option value="2">Saving</option>
            <option value="3">Investment</option>
            <option value="4">College (529)</option>
            <option value="5">Other</option>
            <option value="6">Debt</option>
          </select>
        </div>
      </form>
      <div class="uk-margin">
        <button id="new-account-btn-ok" class="uk-button uk-button-primary flt-rt">ok</button>
        <button id="new-account-btn-cancel" class="uk-button uk-button-secondary flt-rt mar-rt">cancel</button>
      </div>
    </div>
  </div>
  <script>

    let btnNewAccount;
    let btnNewAccountOk;
    let btnNewAccountCancel;

    window.addEventListener("DOMContentLoaded", () => {
      // $("#welcome-section").delay(1000 * 2).fadeOut(400);

      // Show the form when the + account button is clicked
      btnNewAccount = document.querySelector("#btn-new-account");
      btnNewAccount.addEventListener("click", (e) => {
        btnNewAccount.setAttribute("disabled", "");
        e.preventDefault();
        $("#new-account-form").fadeIn(400);
      });

      // Check the form, save the data, hide the form
      btnNewAccountOk = document.querySelector("#new-account-btn-ok");
      btnNewAccountOk.addEventListener("click", (e) => {

        let valid = validateNewAccountForm();

        if (valid) {
          // Send the data to the backend
          console.log("Ship it!");

          // hide the form
          $("#new-account-form").fadeToggle(250, (d) => {
            console.log("it hided!");
            //clear the form
            resetAccountForm();
            //re-enable the + account button
            btnNewAccount.removeAttribute("disabled");
          });
        }
      });

      btnNewAccountCancel = document.querySelector("#new-account-btn-cancel");
      btnNewAccountCancel.addEventListener("click", (e) => {
        console.log("cancelled");
        // hide the form
        $("#new-account-form").fadeToggle(250, (d) => {
          console.log("it hided!");

          // clear the form
          resetAccountForm();
          //re-enable the + account button
          btnNewAccount.removeAttribute("disabled");
        });
      });


    });
    function validateNewAccountForm() {

      formValid = true;

      // check label is a string
      let label = $("#new-account-form-label").val();
      if (!isAlphanumeric(label)) {
        formValid = false;
        $("#new-account-form-label").addClass("invalid");
      } else {
        $("#new-account-form-label").removeClass("invalid");
      }

      // check that balance is a number
      let balance = $("#new-account-form-balance").val();
      let result = Intl.NumberFormat("us-EN").format(balance);
      if (result == "NaN") {
        formValid = false;
        $("#new-account-form-balance").addClass("invalid");
      } else {
        $("#new-account-form-balance").removeClass("invalid");
      }

      // check that type is not 0
      let type = $("#new-account-form-type").val();
      if (type == 0 || type == null) {
        formValid = false;
      }
      console.log(label, result, type);

      return formValid;
    }

    function resetAccountForm() {
      $("#new-account-form-label").val("");
      $("#new-account-form-balance").val("");
      $("#new-account-form-type").val(0);
    }

    function isAlphanumeric(str) {
      return str.match(/^[a-zA-Z0-9]+$/) !== null;
    }

    function isNumeric(str) {
      return str.match(/^[0-9]+$/) !== null;
    }

  </script>
</body>

</html>